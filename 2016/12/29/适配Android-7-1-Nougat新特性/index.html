<!DOCTYPE html>
<html lang="en">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.2 -->

    <!-- Title -->
    
    <title>
        
            适配Android 7.1 Nougat新特性 | 
        
        Tonny&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Tonny">
    <meta name="description" content="null">
    <meta name="keywords" content="null,Android">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Tonny&#39;s Blog">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://tonnyl.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="适配Android 7.1 Nougat新特性 | Tonny&#39;s Blog">
    <meta property="og:description" content="null">
    <meta property="og:article:tag" content="Android"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    

    <!-- Bing Background -->
    
        <script type="text/javascript">
            queue.offer(function(){
                $('body').attr('data-original', 'https://api.i-meto.com/bing?new');
                $('body.lazy').lazyload();
            });
        </script>
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#What’s-new-in-Android-7-1-Nougat"><span class="post-toc-number">1.</span> <span class="post-toc-text">What’s new in Android 7.1 Nougat?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#App-Shortcuts"><span class="post-toc-number">2.</span> <span class="post-toc-text">App Shortcuts</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Using-Static-Shortcuts"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">Using Static Shortcuts</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Using-Dynamic-Shortcuts"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">Using Dynamic Shortcuts</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Extra-Bits"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">Extra Bits</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#App-Shortcuts-Best-Practices"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">App Shortcuts Best Practices</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Round-Icon-Resources"><span class="post-toc-number">3.</span> <span class="post-toc-text">Round Icon Resources</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Image-Keyboard-Support"><span class="post-toc-number">4.</span> <span class="post-toc-text">Image Keyboard Support</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#How-it-works"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">How it works</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Adding-Image-Support-to-Apps"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">Adding Image Support to Apps</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Adding-Image-Support-to-IMEs"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">Adding Image Support to IMEs</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Summary"><span class="post-toc-number">5.</span> <span class="post-toc-text">Summary</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                适配Android 7.1 Nougat新特性
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Tonny</strong>
        <span>Dec 29, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Android/">Android</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;Views
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=适配Android 7.1 Nougat新特性&url=http://tonnyl.github.io//2016/12/29/适配Android-7-1-Nougat新特性/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=适配Android 7.1 Nougat新特性&url=http://tonnyl.github.io//2016/12/29/适配Android-7-1-Nougat新特性/index.html&via=Tonny" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://tonnyl.github.io//2016/12/29/适配Android-7-1-Nougat新特性/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://tonnyl.github.io//2016/12/29/适配Android-7-1-Nougat新特性/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=http://tonnyl.github.io//2016/12/29/适配Android-7-1-Nougat新特性/index.html&title=适配Android 7.1 Nougat新特性" target="_blank">
            <li class="mdl-menu__item">
                Share to LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Tonny&#39;s Blog&title=适配Android 7.1 Nougat新特性&summary=null&pics=http://tonnyl.github.io/img/favicon.png&url=http://tonnyl.github.io/2016/12/29/适配Android-7-1-Nougat新特性/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=http://tonnyl.github.io//2016/12/29/适配Android-7-1-Nougat新特性/index.html&text=适配Android 7.1 Nougat新特性" target="_blank">
            <li class="mdl-menu__item">
                Share to Telegram
            </li>
        </a>
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>老司机带你吃牛轧糖<br><a id="more"></a></p>
<h3 id="What’s-new-in-Android-7-1-Nougat"><a href="#What’s-new-in-Android-7-1-Nougat" class="headerlink" title="What’s new in Android 7.1 Nougat?"></a>What’s new in Android 7.1 Nougat?</h3><p>Android 7.1 Nougat 已经推出有一段时间，相信大多数人和我一样，并没有用上最新的系统，但是，总有一群走在时代的前列线上的Geek们，勇于尝鲜，艰苦奋斗，为刷新版本号贡献自己的力量。好吧，实际上就是我还没有用上7.1，有些眼馋了。那么，和开发者息息相关的有哪些新特性呢？</p>
<img src="/2016/12/29/适配Android-7-1-Nougat新特性/android_nougat.png" alt="Android 7.1 Nougat" title="Android 7.1 Nougat">
<p>本次主要介绍3个新特性:<strong>App Shortcuts</strong>, <strong>Round Icon Resource</strong> 和 <strong>Image Keyboard Support</strong>。所有的新特性可以访问谷歌开发者中文博客的文章<a href="http://developers.googleblog.cn/2016/12/android-711-nougat_20.html" target="_blank" rel="external">欢迎使用Android 7.1.1 Nougat</a>。</p>
<h3 id="App-Shortcuts"><a href="#App-Shortcuts" class="headerlink" title="App Shortcuts"></a>App Shortcuts</h3><p>作为一个密切关注Android发展的伪Geek，在7.1正式版未发布之前，通过网上的一些爆料文章，我就了解到了这一新功能。实际上，这个功能刚开始出现时，我还以为Google Pixel要上压感屏了呢，事实证明，的确是我想多了。</p>
<p>App Shortcuts允许用户直接在启动器中显示一些操作，让用户立即执行应用的深层次的功能。触发这一功能的操作就是「长按」。这一功能类似于iOS中的「3D Touch」。</p>
<p>下面通过一张GIF，直观的感受一下App Shortcuts是怎样的。（由于我的一加3并没有升级到最新的7.1，还只是7.0，所以我安装了Nova Launcher来体验。）</p>
<img src="/2016/12/29/适配Android-7-1-Nougat新特性/app_shortcuts.gif" alt="App Shortcuts" title="App Shortcuts">
<p>长按图标，收到震动后松手，如果能够看到图标上弹出了支持的跳转操作，说明成功的呼出了Shortcuts功能，如果不支持这一功能，在Nova Launcher上弹出的就是卸载或者移除操作，在Pixel Launcher上不会出现弹出菜单，显示的是常见的长按操作。长按弹出的操作，可以将这个操作已快捷方式图标的形式直接放置在主屏上。如果长按主图标不松手，就可以调整位置了。</p>
<p>目前，一个应用最多可以支持 <strong>5</strong> 个Shortcut,可以通过<a href="https://developer.android.com/reference/android/content/pm/ShortcutManager.html#getMaxShortcutCountPerActivity(" target="_blank" rel="external">getMaxShortcutCountPerActivity</a>)查看Launcher最多支持Shortcut的数量。每一个Shortcut都对应着一个或者多个intent，当用户选择某一个Shortcut时，应该做出特定的动作。下面是一些将一些特定的动作作为Shortcuts的例子：</p>
<ul>
<li><p>在地图APP中，指引用户至最常用的位置</p>
</li>
<li><p>在聊天APP中，发送信息至某个好友</p>
</li>
<li><p>在多媒体APP中，播放下一个电视节目</p>
</li>
<li><p>在游戏APP中，加载至上次保存的地方</p>
</li>
</ul>
<p>App Shortcut可以分为两种不同的类型： Static Shortcuts（静态快捷方式） 和 Dynamic Shortcuts（动态快捷方式）。</p>
<ul>
<li>Static Shortcuts：在打包到apk的资源文件中定义，所以，直到下一次更新版本时才能改变静态快捷方式的详细说明。</li>
<li>Dynamic Shortcuts：通过ShortcutManager API在运行时发布，在运行时，应用可以发布，升级和移除快捷方式。</li>
</ul>
<h4 id="Using-Static-Shortcuts"><a href="#Using-Static-Shortcuts" class="headerlink" title="Using Static Shortcuts"></a>Using Static Shortcuts</h4><p>创建Static Shortcuts分为以下几步：</p>
<p>1.在工程的manifest文件 (AndroidManifest.xml)下，找到 intent filter设置为 <strong>android.intent.action.MAIN</strong> 和 <strong>android.intent.category.LAUNCHER</strong> 的Activity。</p>
<p>2.在次Activity下添加<meta-data>标签，引用定义shortcuts的资源文件。</meta-data></p>
<pre><code class="xml">&lt;activity
        android:name=&quot;.homepage.MainActivity&quot;
        android:configChanges=&quot;orientation|keyboardHidden|screenSize|screenLayout&quot;
        android:label=&quot;@string/app_name&quot;
        android:theme=&quot;@style/AppTheme.NoActionBar&quot;&gt;
        &lt;intent-filter&gt;
            &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;

            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
        &lt;/intent-filter&gt;

        &lt;meta-data
            android:name=&quot;android.app.shortcuts&quot;
            android:resource=&quot;@xml/shortcuts&quot; /&gt;
    &lt;/activity&gt;
</code></pre>
<p>3.创建新的资源文件<code>res/xml/shortcuts.xml</code></p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;shortcuts xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;

    &lt;shortcut
        android:enabled=&quot;true&quot;
        android:icon=&quot;@drawable/ic_search_circle&quot;
        android:shortcutId=&quot;search_bookmarks&quot;
        android:shortcutShortLabel=&quot;@string/search_bookmarks&quot;
        android:shortcutLongLabel=&quot;@string/search_bookmarks&quot;&gt;

        &lt;intent
            android:action=&quot;android.intent.action.VIEW&quot;
            android:targetPackage=&quot;com.marktony.zhihudaily&quot;
            android:targetClass=&quot;com.marktony.zhihudaily.search.SearchActivity&quot; /&gt;

        &lt;!--如果你的一个shortcut关联着多个intent，你可以在这里继续添
            加。最后一个intent决定着用户在加载这个shortcut时会看到什么--&gt;

        &lt;categories android:name=&quot;android.shortcut.conversation&quot; /&gt;

    &lt;/shortcut&gt;

    &lt;!--在这里添加更多的shortcut--&gt;

&lt;/shortcuts&gt;
</code></pre>
<p><strong>shortcut</strong>下标签的含义：</p>
<ul>
<li><p>enabled:见名知意，shortcut是否可用。如果你决定让这个static shortcut不在可用的话，可直接将其设置为 <strong>false</strong> ，或者直接从 <strong>shortcuts</strong> 标签中移除。</p>
</li>
<li><p>icon:显示在左边的图标，可用使用<em>Vector drawable</em>。</p>
</li>
<li><p>shortcutDisabledMessage:当禁用此shortcut后，它仍然会出现在用户长按应用图标后的快捷方式列表里，也可以被拖动并固定到桌面上，但是它会呈现灰色并且用户点击时会弹出Toast这个标签所定义的内容。</p>
</li>
<li><p>shortcutLongLabel:当启动器有足够多的空间时，会显示这个标签所定义的内容。</p>
</li>
<li><p>shortcutShortLabel:shortcut的简要说明，是必需字段。当shortcut被添加到桌面上时，显示的也是这个字段。</p>
</li>
<li><p>intent:shortcut关联的一个或者多个intent，当用户点击shortcut时被打开。</p>
</li>
<li><p>shortcutId:shortcut的唯一标示id，若存在具有相同shortcutId的shortcut，则只显示一个。</p>
</li>
</ul>
<p>到这里，最简单的shortcut就添加成功了。运行包含上面的文件的项目，点击shortcut就可以直接进入 <strong>SearchActivity</strong>，当按下back键时，直接就退出了应用。如果希望不退出应用，而是进入 <strong>MainActivity</strong> 时，应该怎么办呢？不用着急，在shortcut继续添加intent就可以了。</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;shortcuts xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;

    &lt;shortcut
        android:enabled=&quot;true&quot;
        android:icon=&quot;@drawable/ic_search_circle&quot;
        android:shortcutId=&quot;search_bookmarks&quot;
        android:shortcutShortLabel=&quot;@string/search_bookmarks&quot;
        android:shortcutLongLabel=&quot;@string/search_bookmarks&quot;&gt;

        &lt;intent
                android:action=&quot;android.intent.action.MAIN&quot;
                android:targetClass=&quot;com.marktony.zhihudaily.homepage.MainActivity&quot;
            android:targetPackage=&quot;com.marktony.zhihudaily&quot; /&gt;

        &lt;intent
            android:action=&quot;android.intent.action.VIEW&quot;
            android:targetPackage=&quot;com.marktony.zhihudaily&quot;
            android:targetClass=&quot;com.marktony.zhihudaily.search.SearchActivity&quot; /&gt;

        &lt;categories android:name=&quot;android.shortcut.conversation&quot; /&gt;

    &lt;/shortcut&gt;

      &lt;!--在这里添加更多的shortcut--&gt;

 &lt;/shortcuts&gt;
</code></pre>
<h4 id="Using-Dynamic-Shortcuts"><a href="#Using-Dynamic-Shortcuts" class="headerlink" title="Using Dynamic Shortcuts"></a>Using Dynamic Shortcuts</h4><p>动态快捷方式应该和应用内的特定的、上下文敏感的action链接。这些action应该可以在用户的几次使用之间、甚至是在应用运行过程中被改变。好的候选action包括打电话给特定的人、导航至特定的地方、或者展示当前游戏的分数。</p>
<p><a href="https://developer.android.com/reference/android/content/pm/ShortcutManager.html" target="_blank" rel="external">ShortcutManager</a> API允许我们在动态快捷方式上完成下面的操作：</p>
<ul>
<li><p>发布:使用setDynamicShortcuts()重新定义整个动态快捷方式列表，或者是使用addDynamicShortcuts()向已存在的动态快捷方式列表中添加快捷方式。</p>
</li>
<li><p>更新:使用updateShortcuts()方法。</p>
</li>
<li><p>移除:使用removeDynamicShortcuts()方法移除特定动态快捷方式或者使用removeAllDynamicShortcuts()移除所有动态快捷方式。</p>
</li>
</ul>
<p>下面是在MainActivity的onCreate()中创建动态快捷方式的例子：</p>
<pre><code class="java">@Override
protected void onCreate(Bundle savedInstanceState) {

    ...

    ShortcutManager shortcutManager = getSystemService(ShortcutManager.class);

    ShortcutInfo webShortcut = new ShortcutInfo.Builder(this, &quot;shortcut_web&quot;)
            .setShortLabel(&quot;github&quot;)
            .setLongLabel(&quot;Open Tonny&#39;s github web site&quot;)
            .setIcon(Icon.createWithResource(this, R.drawable.ic_dynamic_shortcut))
            .setIntent(new Intent(Intent.ACTION_VIEW, Uri.parse(&quot;https://TonnyL.github.io&quot;)))
            .build();

    shortcutManager.setDynamicShortcuts(Collections.singletonList(webShortcut));
}
</code></pre>
<p>也可以为动态快捷方式创建返回栈。</p>
<pre><code class="java">@Override
protected void onCreate(Bundle savedInstanceState) {

    ...

    ShortcutInfo dynamicShortcut = new ShortcutInfo.Builder(this, &quot;shortcut_dynamic&quot;)
            .setShortLabel(&quot;Dynamic&quot;)
            .setLongLabel(&quot;Open dynamic shortcut&quot;)
            .setIcon(Icon.createWithResource(this, R.drawable.ic_dynamic_shortcut_2))
            .setIntents(
                    new Intent[]{
                            new Intent(Intent.ACTION_MAIN, Uri.EMPTY, this, MainActivity.class).setFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK),
                            new Intent(DynamicShortcutActivity.ACTION)
                    })
            .build();

    shortcutManager.setDynamicShortcuts(Arrays.asList(webShortcut, dynamicShortcut));
}
</code></pre>
<p>创建一个新的空的Activity，名字叫做DynamicShortcutActivity，在manifest文件中注册。</p>
<pre><code class="xml">&lt;activity  
      android:name=&quot;.DynamicShortcutActivity&quot;
      android:label=&quot;Dynamic shortcut activity&quot;&gt;
      &lt;intent-filter&gt;
        &lt;action android:name=&quot;com.marktony.zhihudaily.OPEN_DYNAMIC_SHORTCUT&quot; /&gt;
        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
      &lt;/intent-filter&gt;
&lt;/activity&gt;
</code></pre>
<p>通过清除array中的排序过的intents，当我们通过创建好的shortcut进入DynamicShortcutActivity之后，按下back键，MainActivity就会被加载。</p>
<p>需要注意的是，在动态创建快捷方式之前，最好是检查一下是否超过了所允许的最大值。否则会抛出相应的异常。</p>
<h4 id="Extra-Bits"><a href="#Extra-Bits" class="headerlink" title="Extra Bits"></a>Extra Bits</h4><ul>
<li><p>当static shortcut 和 dynamic shortcut一起展示时，其出现的顺序是怎样定制呢？</p>
<p>  在 <strong>ShortcutInfo.Builder</strong> 中有一个专门的方法 <strong>setRank(int)</strong> ,通过设置不同的等级，我们就可以控制动态快捷方式的出现顺序，等级越高，出现在快捷方式列表中的位置就越高。</p>
</li>
<li><p>我们还可以设置动态快捷方式的shortLabel的字体颜色。</p>
<pre><code class="java">  ForegroundColorSpan colorSpan = new ForegroundColorSpan(getResources().getColor(android.R.color.holo_red_dark, getTheme()));
  String label = &quot;github&quot;;
  SpannableStringBuilder colouredLabel = new SpannableStringBuilder(label);
  colouredLabel.setSpan(colorSpan, 0, label.length(), Spanned.SPAN_INCLUSIVE_INCLUSIVE);

  ShortcutInfo webShortcut = new ShortcutInfo.Builder(MainActivity.this, &quot;shortcut_web&quot;)
          .setShortLabel(colouredLabel)
          .setRank(1)
          .build();
</code></pre>
</li>
</ul>
<h4 id="App-Shortcuts-Best-Practices"><a href="#App-Shortcuts-Best-Practices" class="headerlink" title="App Shortcuts Best Practices"></a>App Shortcuts Best Practices</h4><p>当设计和创建应用的shortcuts时，应该遵守下面的指导建议：</p>
<ul>
<li><p>遵循设计规范:为了保持我们的应用和系统应用的快捷方式在视觉上一致性，应该遵守<a href="https://developer.android.com/shareables/design/app-shortcuts-design-guidelines.pdf" target="_blank" rel="external">App Shortcuts Design Guidelines</a>。</p>
</li>
<li><p>发布4个不同的快捷方式:尽管现在的API支持静态和动态总共5个快捷方式，但是为了提高shortcut的视觉效果，建议只添加4个不同的快捷方式。</p>
</li>
<li><p>限制快捷方式描述的文本长度:在Launcher中，显示快捷方式时，空间长度受到了限制。如果可能的话，应该将「short description」的文字长度控制在10个字母以内，将「long discription」的长度限制在25个字母以内。</p>
</li>
<li><p>保存shortcut和action的历史记录:创建的每一个shortcut，应该考虑到用户能够通过不同的方式完成相同的任务。在这种情况下，记得调用 <strong>reportShortcutUsed()</strong> 方法，这样，launcher就可以提高shortcut对应的actions的反应速度。</p>
</li>
<li><p>只有在shortcuts的意义存在时更新：当改变动态快捷方式时，只有在shortcut仍然保持着它的含义时，调用 <strong>updateShortcuts()</strong> 方法改变它的信息。否则，应该使用<strong>addDynamicShortcuts()</strong> 或者 <strong>setDynamicShortcuts()</strong> 创建一个具有新含义的ID的快捷方式。</p>
<p>  举个例子，如果我们已经创建了导航到一个超市的快捷方式，如果超市的名称改变了但是位置并没有变化时，只更新信息是合适的。但是如果用户开始在一个不同位置的超市购物时，最好是创建一个全新的快捷方式(而不仅仅是更新信息了)。</p>
</li>
<li><p>在备份和恢复时，动态shortcuts不应该被保存:正是因为这个原因，推荐我们在需要APP启动和重新发布动态快捷方式时，检查 <strong>getDynamicShortcuts()</strong> 的对象的数量。可以参考<a href="https://developer.android.com/guide/topics/ui/shortcuts.html#backup-and-restore" target="_blank" rel="external">Backup and Restore</a>部分的代码片段。</p>
</li>
</ul>
<h3 id="Round-Icon-Resources"><a href="#Round-Icon-Resources" class="headerlink" title="Round Icon Resources"></a>Round Icon Resources</h3><p>在Android 7.1上，Google推出了一个部分用户可能不太喜欢的特性–圆形图标。圆形图标长什么样，可以看看下面的图。</p>
<img src="/2016/12/29/适配Android-7-1-Nougat新特性/round_icon.png" alt="round icon" title="round icon">
<blockquote>
<p>同时，圆形图标规范也作为一部分内容加入到了更新说明和开发文档中。<br>应用程序现在可以定义圆形启动器图标以用于特定的移动设备之上。当启动器请求应用程序图标时，程序框架应返回 android：icon 或 android：roundIcon，视设备具体要求而定。因此，应用程序在开发时应该确保同时定义 android：icon和 android：roundIcon 两个变量。您可以使用 Image Asset Studio 来设计圆形图标。</p>
<p>您应该确保在支持新的圆形图标的设备上测试您的应用程序，以确保应用程序图标的外观无虞和实际效果。测试您的资源的一种方法是在 Google Pixel 设备上安装您的应用。您还可以通过运行 Android 模拟器并使用 Google API 模拟器系统（目标 API 等级为 25）测试您的图标。</p>
</blockquote>
<p>我们可以通过 <strong>Android Studio</strong> 自带的 <strong>Image Asset Studio</strong>设计图标。在项目的 <strong>res</strong> 目录下点击鼠标右键，选择 <strong>new</strong> –&gt; <strong>Image Asset</strong> 即可设计图标。</p>
<img src="/2016/12/29/适配Android-7-1-Nougat新特性/ImageAssetStudio.png" alt="Image Asset Studio" title="Image Asset Studio">
<p>更多关于设计应用图标的信息，可以参考<a href="https://material.google.com/style/icons.html#icons-product-icons" target="_blank" rel="external">Material Design guidelines</a>。</p>
<h3 id="Image-Keyboard-Support"><a href="#Image-Keyboard-Support" class="headerlink" title="Image Keyboard Support"></a>Image Keyboard Support</h3><p>在较早版本的Android系统中，软键盘(例如我们所熟知的Input Method Editors，或者说IME)，只能够给应用发送unicode编码的emoji，对于rich content，应用只能通过使用自建的私有的API实现发送图片的功能。而在Android 7.1中，SDK包含了一个全新的Commit Content API，输入法应用不仅可以调用此 API 实现发送图片和其他rich content，一些通讯应用（比如 Google Messenger）也可以通过此 API 来更好地处理这些来自输入法的图片、网页信息和 GIF 内容。</p>
<img src="/2016/12/29/适配Android-7-1-Nougat新特性/image-keyboard-sample.png" alt="image keyboard" title="image keyboard">
<h4 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works"></a>How it works</h4><ol>
<li><p>当用户点击EditText时，    editor会发送一个它所能接受的 <strong>EditorInfo.contentMimeTypes</strong> MIME 内容类型的列表。</p>
</li>
<li><p>IME读取这个在软键盘中支持类型和展示内容的列表。</p>
</li>
<li><p>当用户选择一张图片后，IME调用 <strong>commitContent()</strong> 并向editor发送一个InputContentInfo。 <strong>commitContent()</strong> 方法是一个类似于 <strong>commitText()</strong> 的方法，但是是rich content的。 <strong>InputContentInfo</strong> 包含着一个表示content provider中内容的URI。然后我们的应用就可以请求相应的权限并读取URI中的内容。</p>
</li>
</ol>
<img src="/2016/12/29/适配Android-7-1-Nougat新特性/image-keyboard-diagram.png" alt="image keyboard diagram" title="image keyboard diagram">
<h4 id="Adding-Image-Support-to-Apps"><a href="#Adding-Image-Support-to-Apps" class="headerlink" title="Adding Image Support to Apps"></a>Adding Image Support to Apps</h4><p>为了接收来自IME的rich content，应用必须告诉IME它所能接收的内容类型并之指定当接收到内容后的回调方法。下面是一个怎样创建一个能够接收PNG图片的 <strong>EditText</strong> 的演示代码。</p>
<pre><code class="java">EditText editText = new EditText(this) {
    @Override
    public InputConnection onCreateInputConnection(EditorInfo editorInfo) {
        final InputConnection ic = super.onCreateInputConnection(editorInfo);
        EditorInfoCompat.setContentMimeTypes(editorInfo,
                new String [] {&quot;image/png&quot;});

        final InputConnectionCompat.OnCommitContentListener callback =
            new InputConnectionCompat.OnCommitContentListener() {
                @Override
                public boolean onCommitContent(InputContentInfoCompat inputContentInfo,
                        int flags, Bundle opts) {
                    // read and display inputContentInfo asynchronously
                    if (BuildCompat.isAtLeastNMR1() &amp;&amp; (flags &amp;
                        InputConnectionCompat.INPUT_CONTENT_GRANT_READ_URI_PERMISSION) != 0) {
                        try {
                            inputContentInfo.requestPermission();
                        }
                        catch (Exception e) {
                            return false; // return false if failed
                        }
                    }

                    // read and display inputContentInfo asynchronously.
                    // call inputContentInfo.releasePermission() as needed.

                    return true;  // return true if succeeded
                }
            };
        return InputConnectionCompat.createWrapper(ic, editorInfo, callback);
    }
};
</code></pre>
<p>代码还是蛮多的，解释一下。</p>
<ul>
<li><p>例子使用了support library，并且引用的是 <strong>android.support.v13.view.inputmethod</strong> 而不是 <strong>android.view.inputmethod</strong> 。</p>
</li>
<li><p>例子创建了一个 <strong>EditText</strong> 并复写了它改变 <strong>InputConnection</strong> 的 <strong>onCreateInputConnection(EditorInfo)</strong> 方法. <strong>InputConnection</strong> 是IME和正在接收输入的沟通管道。</p>
</li>
<li><p>调用 <strong>super.onCreateInputConnection()</strong> 保留了内建的行为(包括发送和接收文本)，并提供给我们一个 <strong>InputConnection</strong> 的引用。</p>
</li>
<li><p><strong>setContentMimeTypes()</strong> 向 <strong>EditorInfo</strong> 添加了一个所支持的MIME类型的列表。 需要保证在 <strong>setContentMimeTypes()</strong> 之前调用 <strong>super.onCreateInputConnection()</strong> 。</p>
</li>
<li><p>回调在IME提交内容是被执行。 <strong>onCommitContent()</strong> 方法有一个对包含了内容URI的 <strong>InputContentInfoCompat</strong> 的引用。</p>
<ul>
<li>当我们的应用运行在API Level 25或者更高并且IME设置了 <strong>INPUT_CONTENT_GRANT_READ_URI_PERMISSION</strong> flag时，我们应该请求并且释放权限。否则，我们应该在此之前就拥有content URI的访问权限，一是因为权限是由IME授权的，二是content provider不对访问进行约束。更多的信息可以访问<a href="https://developer.android.com/guide/topics/text/image-keyboard.html#adding_image_support_to_imes" target="_blank" rel="external">Adding Image Support to IMEs</a></li>
</ul>
</li>
<li><p><strong>createWrapper()</strong> 包装了inputConnection和已修改的editorInfo，新的InputConnection的回调并且返回。</p>
</li>
</ul>
<p>下面是一些实践小技巧。</p>
<ul>
<li><p>不支持rich content的Editor不应该调用 <strong>setContentTypes()</strong> 并把 <strong>EditorInfo.contentMimeTypes</strong> 设置为null。</p>
</li>
<li><p>Editor应该忽略掉在 <strong>InputConnectionInfo</strong> 中指定的MIME类型和所接收类型不通的内容。</p>
</li>
<li><p>rich content不影响也不被文本指针的位置所影响。editor在进行内容处理是可以直接忽略掉光标的位置。</p>
</li>
<li><p>在editor的 <strong>OnCommitContentListener.onCommitContent()</strong> 方法中，我们可以异步的返回true，甚至是在加载内容之前。</p>
</li>
<li><p>不同于文本内容在被提交之前可以在IME中被编辑，rich content会被立即提交。需要注意特性，如果想要提供编辑或者删除内容的能力，我们需要自己提供处理逻辑。</p>
</li>
</ul>
<p>为了测试APP，需要确保你的设备或者虚拟机的键盘能够发送rich content。你可以在Android 7.1或者更高的系统中使用Google Keyboard，或者是安装<a href="https://developer.android.com/samples/CommitContentSampleIME/index.html" target="_blank" rel="external">CommitContent IME sample</a>.</p>
<p>你可以在<a href="https://developer.android.com/samples/CommitContentSampleApp/index.html" target="_blank" rel="external">CommitContent App sample</a>获取到完整的示例代码。</p>
<h4 id="Adding-Image-Support-to-IMEs"><a href="#Adding-Image-Support-to-IMEs" class="headerlink" title="Adding Image Support to IMEs"></a>Adding Image Support to IMEs</h4><p>想要IME支持发送rich content，需要引入下面所展示的Commit Content API。</p>
<ul>
<li><p>复写 <strong>onStartInput()</strong> 或者 <strong>onStartInputView()</strong> ，并读取来自目标editor的支持内容类型列表。</p>
<pre><code class="java">  @Override
  public void onStartInputView(EditorInfo info, boolean restarting) {
      String[] mimeTypes = EditorInfoCompat.getContentMimeTypes(editorInfo);

      boolean gifSupported = false;
      for (String mimeType : mimeTypes) {
          if (ClipDescription.compareMimeTypes(mimeType, &quot;image/gif&quot;)) {
              gifSupported = true;
          }
      }

      if (gifSupported) {
          // the target editor supports GIFs. enable corresponding content
      } else {
          // the target editor does not support GIFs. disable corresponding content
      }
  }
</code></pre>
</li>
<li><p>当用户选择了一张图片时，将内容提交给APP。当IME有正在编辑的文本时，应该避免调用 <strong>commitContent()</strong> ，因为这样可能导致editor失去焦点。下面的代码片段展示了怎样提交一张GIF图片。</p>
<pre><code class="java">  /**
   * Commits a GIF image
   *
   * @param contentUri Content URI of the GIF image to be sent
   * @param imageDescription Description of the GIF image to be sent
   */
  public static void commitGifImage(Uri contentUri, String imageDescription) {
      InputContentInfoCompat inputContentInfo = new InputContentInfoCompat(
              contentUri,
              new ClipDescription(imageDescription, new String[]{&quot;image/gif&quot;}));
      InputConnection inputConnection = getCurrentInputConnection();
      EditorInfo editorInfo = getCurrentInputEditorInfo();
      Int flags = 0;
      If (android.os.Build.VERSION.SDK_INT &gt;= 25) {
          flags |= InputConnectionCompat.INPUT_CONTENT_GRANT_READ_URI_PERMISSION;
      }
      InputConnectionCompat.commitContent(
              inputConnection, editorInfo, inputContentInfo, flags, opts);
  }
</code></pre>
</li>
<li><p>作为一个IME开发者，有很大可能你需要引入你自己的content provider来响应content URI请求。如果你的IME支持来自像 <strong>MediaStore</strong> 这样已经存在的content provider倒是可以例外。关于创建content provider的更多信息，可以参见 <a href="https://developer.android.com/samples/CommitContentSampleIME/index.html" target="_blank" rel="external">CommitContent IME sample</a>, [Content Provider] (<a href="https://developer.android.com/guide%20/topics/providers/content-providers.html)文档" target="_blank" rel="external">https://developer.android.com/guide%20/topics/providers/content-providers.html)文档</a>, <a href="https://developer.android.com/training/secure-file-sharing/setup-sharing.html" target="_blank" rel="external">File Provider</a>文档。</p>
</li>
<li><p>如果正在创建自己的content provider，建议不要export(将 android:export 设置为false)。通过设置 <strong>android:grandUriPermission</strong> 为true允许在provider内部进行权限授予替代。然后，你的IME在内容提交时可以授予访问content URI的权限。有两种实现的方法：</p>
<ul>
<li><p>在Android 7.1(API Level 25)或更高的系统中，当调用 <strong>commitContent</strong> 方法时，将flag参数设置为 <strong>INPUT_CONTENT_GRANT_READ_URI_PERMISSION</strong> 。然后，APP收到的 <strong>InputContentInfo</strong> 对象可以通过调用 <strong>requestPermission()</strong> 方法和 <strong>releasePermission()</strong> 请求和释放临时访问权限。</p>
</li>
<li><p>在Android 7.0(API Level 24)或者更低的系统中， <strong>INPUT_CONTENT_GRANT_READ_URI_PERMISSION</strong> 直接被忽略，所以我们需要手动的授予内容访问权限。方法就是 <strong>grantUriPermission()</strong> ,但是我们也可以引入满足自己要求的机制。</p>
</li>
</ul>
</li>
</ul>
<p>权限授予的例子，我们可以在<a href="https://developer.android.com/samples/CommitContentSampleIME/index.html" target="_blank" rel="external">CommitContent IME sample</a>中的doCommitContent()方法。</p>
<p>为了测试IME，确保我们的设备或者模拟器拥有接收rich content的的应用。我们可以在Android 7.1或者更高的系统中使用Google Messenger应用或者安装<a href="https://developer.android.com/samples/CommitContentSampleApp/index.html" target="_blank" rel="external">CommitContent App Sample</a>。</p>
<p>获取完整的示例代码，可以访问<a href="https://developer.android.com/samples/CommitContentSampleIME/index.html" target="_blank" rel="external">CommitContent IME Sample</a>。</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>Google在刷新版本号的路上简直是在策马奔腾了，嘚儿驾。我们也能够看到Google的努力，Android也在变的越来越好，加油吧，小机器人。</p>
<p>本次Shortcuts部分的代码可以在我的GitHub仓库<a href="https://github.com/TonnyL/ZhiHuDaily" target="_blank" rel="external">ZhiHuDaily</a>中看到。欢迎star哟。</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用多说评论 -->
    <link rel="stylesheet" href="/css/duoshuo.min.css">
<style>
    #ds-thread #ds-reset .ds-post-button{
        background-color: #0097A7 !important;
    }
    #ds-wrapper #ds-reset .ds-icons-32{
        background-color: #0097A7 !important;
    }
    #ds-reset .ds-highlight {
        color: #0097A7 !important;
    }
</style>
<div id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread"
        data-thread-key="2016/12/29/适配Android-7-1-Nougat新特性/"
        data-url="http://tonnyl.github.io/2016/12/29/适配Android-7-1-Nougat新特性/"
        data-title="适配Android 7.1 Nougat新特性">
    </div>
    <!-- 多说评论框 end -->
</div>









                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/12/31/简洁优雅地实现夜间模式/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/11/05/JAVA深克隆与浅克隆/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Tonny's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        marktonymengyi@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:marktonymengyi@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/04/">April 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">December 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">September 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">July 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">June 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">May 2016<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Android/">Android<span class="sidebar_archives-count">18</span></a></li><li><a class="sidebar_archives-link" href="/categories/GitHub/">GitHub<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Java/">Java<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/涨姿势/">涨姿势<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/计算机基础/">计算机基础<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/设计模式/">设计模式<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/闲谈/">闲谈<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
            <li class="divider"></li>
        
    
        <li>
            <a href="/links" title="Links">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                Links
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">29</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            Theme - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

    <a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.help
        <span class="mdl-button__ripple-container">
          <span class="mdl-ripple"></span>
        </span>
      </div>
    </a>

-->

<!-- Feedback -->
<!--

    <a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.feedback
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

<!-- About Theme -->
<!--

    <a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
             sidebar.about_theme
            <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/TonnyLZTL" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    

    <!-- Google + -->
    
        <a href="https://plus.google.com/101922840132193208151" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.svg);">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/5313690193/profile?topnav=1&amp;wvr=6" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.svg);">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    
        <a href="https://www.instagram.com/tonny_lztl/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-instagram.svg);">
                <span class="visuallyhidden">Instagram</span>
            </button><!--
     --></a>
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/TonnyL" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.svg);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://www.zhihu.com/people/kirin-momo/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-zhihu.svg);">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
        <a href="https://t.me/TonnyLZ" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-telegram.svg);">
                <span class="visuallyhidden">Telegram</span>
            </button><!--
     --></a>
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;Tonny's Blog
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    <!-- 多说公共 js 代码 start -->
    <script type="text/javascript">
        queue.offer(function(){
            var duoshuoQuery = {
                short_name: 'tonnysblog'
            };
            (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';
                ds.async = true;
                ds.src = 'https://static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0]
                 || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
        });
    </script>
    <!-- 多说公共 js 代码 end -->






<!-- Swiftye -->


<!-- Local Search-->

    <script>
    var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: 'xml',
            success: function( xmlResponse ) {
                // get the contents from search data
                var datas = $( 'entry', xmlResponse ).map(function() {
                    return {
                        title: $( 'title', this ).text(),
                        content: $('content',this).text(),
                        url: $( 'url' , this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function() {
                    var str='<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = '';
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function(data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g,'').toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if(data_title !== '' && data_content !== '') {
                            keywords.forEach(function(keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if( index_title < 0 && index_content < 0 ) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += '<li><a href="'+ data_url +'" class="search-result-title" target="_blank">'+ data_title;
                            var content = data.content.trim().replace(/<[^>]+>/g, '');
                            if (first_occur >= 0) {
                                // cut out characters
                                var start = first_occur - 6;
                                var end = first_occur + 6;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 10;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, 'gi');
                                    match_content = match_content.replace(regS, '<em class="search-keyword">'+keyword+'</em>');
                                })
                                str += '<p class="search-result">' + match_content + '...</p>' +'</a>';
                            }
                        }
                    });
                    $resultContent.innerHTML = str;
                });
            }
        });
    }
</script>


    <script>
        var inputArea = document.querySelector('#search');
        var getSearchFile = function() {
            var path = 'search.xml';
            searchFunc(path, 'search', 'local-search-result');
        }

        if(inputArea) {
            inputArea.onfocus = function() {
                getSearchFile();
            }
        }
    </script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
