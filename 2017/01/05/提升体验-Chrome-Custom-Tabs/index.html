<!DOCTYPE html>
<html lang="en">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.2 -->

    <!-- Title -->
    
    <title>
        
            提升体验-Chrome Custom Tabs | 
        
        Tonny&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Tonny">
    <meta name="description" content="null">
    <meta name="keywords" content="null,Android">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Tonny&#39;s Blog">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://tonnyl.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="提升体验-Chrome Custom Tabs | Tonny&#39;s Blog">
    <meta property="og:description" content="null">
    <meta property="og:article:tag" content="Android"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="https://materialcdn.nfz.moe/hexo/1.3.2/css/material.min.css">
        <link rel="stylesheet" href="https://materialcdn.nfz.moe/hexo/1.3.2/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="https://materialcdn.nfz.moe/hexo/1.3.2/js/jquery.min.js"></script>
        <script src="https://materialcdn.nfz.moe/hexo/1.3.2/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    

    <!-- Bing Background -->
    
        <script type="text/javascript">
            queue.offer(function(){
                $('body').attr('data-original', 'https://api.i-meto.com/bing?new');
                $('body.lazy').lazyload();
            });
        </script>
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#什么是Custom-Tabs"><span class="post-toc-number">2.</span> <span class="post-toc-text">什么是Custom Tabs?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Chrome-Custom-Tabs-VS-WebView-我应该什么时候用？"><span class="post-toc-number">3.</span> <span class="post-toc-text">Chrome Custom Tabs VS WebView, 我应该什么时候用？</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#什么时候可用？"><span class="post-toc-number">4.</span> <span class="post-toc-text">什么时候可用？</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#开发指南"><span class="post-toc-number">5.</span> <span class="post-toc-text">开发指南</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#打开一个Chrome-Custom-Tab"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">打开一个Chrome Custom Tab</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置地址栏的颜色"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">配置地址栏的颜色</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置定制化的action-button"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">配置定制化的action button</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置定制化菜单"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">配置定制化菜单</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置进场和退场动画"><span class="post-toc-number">5.5.</span> <span class="post-toc-text">配置进场和退场动画</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#预热Chrome，提高页面加载速度"><span class="post-toc-number">5.6.</span> <span class="post-toc-text">预热Chrome，提高页面加载速度</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#连接Chrome服务"><span class="post-toc-number">5.7.</span> <span class="post-toc-text">连接Chrome服务</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#预热浏览器"><span class="post-toc-number">5.8.</span> <span class="post-toc-text">预热浏览器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#创建新的tab-sessioin"><span class="post-toc-number">5.9.</span> <span class="post-toc-text">创建新的tab sessioin</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#告知Chrome用户可能打开的链接"><span class="post-toc-number">5.10.</span> <span class="post-toc-text">告知Chrome用户可能打开的链接</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Custom-Tabs连接回调"><span class="post-toc-number">5.11.</span> <span class="post-toc-text">Custom Tabs连接回调</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#如果用户没有安装最新版本的Chrome，会发生什么呢？"><span class="post-toc-number">5.12.</span> <span class="post-toc-text">如果用户没有安装最新版本的Chrome，会发生什么呢？</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#怎样检测Chrome是否支持Chrome-Custom-Tabs"><span class="post-toc-number">5.13.</span> <span class="post-toc-text">怎样检测Chrome是否支持Chrome Custom Tabs?</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#最佳实践"><span class="post-toc-number">6.</span> <span class="post-toc-text">最佳实践</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#连接Custome-Tabs-Service并发起预热"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">连接Custome Tabs Service并发起预热</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#内容预渲染"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">内容预渲染</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#当Custom-Tabs没有安装时，提供备选方案"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">当Custom Tabs没有安装时，提供备选方案</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#将我们的应用作为referrer-引荐来源"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">将我们的应用作为referrer(引荐来源)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#添加定制动画"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">添加定制动画</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#为Action-Button选择一个icon"><span class="post-toc-number">6.6.</span> <span class="post-toc-text">为Action Button选择一个icon</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#为其他浏览器做准备"><span class="post-toc-number">6.7.</span> <span class="post-toc-text">为其他浏览器做准备</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#允许用户不使用Custom-Tabs"><span class="post-toc-number">6.8.</span> <span class="post-toc-text">允许用户不使用Custom Tabs</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#尽量让Native应用处理URL"><span class="post-toc-number">6.9.</span> <span class="post-toc-text">尽量让Native应用处理URL</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#定制Toolbar的颜色"><span class="post-toc-number">6.10.</span> <span class="post-toc-text">定制Toolbar的颜色</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#增加分享按钮"><span class="post-toc-number">6.11.</span> <span class="post-toc-text">增加分享按钮</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#定制关闭按钮"><span class="post-toc-number">6.12.</span> <span class="post-toc-text">定制关闭按钮</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#处理内部链接"><span class="post-toc-number">6.13.</span> <span class="post-toc-text">处理内部链接</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#处理连击"><span class="post-toc-number">6.14.</span> <span class="post-toc-text">处理连击</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#低版本API"><span class="post-toc-number">7.</span> <span class="post-toc-text">低版本API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#在低版本API中使用Custom-Tabs的基本方法"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">在低版本API中使用Custom Tabs的基本方法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#定制UI"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">定制UI</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#连接Custom-Tabs-Service"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">连接Custom Tabs Service</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一些有用的网址"><span class="post-toc-number">8.</span> <span class="post-toc-text">一些有用的网址</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#总结"><span class="post-toc-number">9.</span> <span class="post-toc-text">总结</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(http://www.androidexplained.com/wp-content/uploads/2015/05/Chrome_Custom_Tabs.png?x16770)">
    
            <p class="article-headline-p">
                提升体验-Chrome Custom Tabs
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Tonny</strong>
        <span>Jan 05, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Android/">Android</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;Views
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=提升体验-Chrome Custom Tabs&url=http://tonnyl.github.io//2017/01/05/提升体验-Chrome-Custom-Tabs/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=提升体验-Chrome Custom Tabs&url=http://tonnyl.github.io//2017/01/05/提升体验-Chrome-Custom-Tabs/index.html&via=Tonny" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://tonnyl.github.io//2017/01/05/提升体验-Chrome-Custom-Tabs/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://tonnyl.github.io//2017/01/05/提升体验-Chrome-Custom-Tabs/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=http://tonnyl.github.io//2017/01/05/提升体验-Chrome-Custom-Tabs/index.html&title=提升体验-Chrome Custom Tabs" target="_blank">
            <li class="mdl-menu__item">
                Share to LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Tonny&#39;s Blog&title=提升体验-Chrome Custom Tabs&summary=null&pics=http://tonnyl.github.io/img/favicon.png&url=http://tonnyl.github.io/2017/01/05/提升体验-Chrome-Custom-Tabs/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=http://tonnyl.github.io//2017/01/05/提升体验-Chrome-Custom-Tabs/index.html&text=提升体验-Chrome Custom Tabs" target="_blank">
            <li class="mdl-menu__item">
                Share to Telegram
            </li>
        </a>
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>使用Chrome Custom Tabs加载网页可以有效的提升用户的体验<br><a id="more"></a></p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>文章比较长，先放项目地址:<a href="https://github.com/TonnyL/PaperPlane" target="_blank" rel="external">PaperPlane</a></p>
<p>俗话说，没图说个那啥，先看实际效果。<br><img src="/2017/01/05/提升体验-Chrome-Custom-Tabs/telegram.gif" alt="telegram" title="telegram"><br><img src="/2017/01/05/提升体验-Chrome-Custom-Tabs/paper_plane.gif" alt="paper plane" title="paper plane"></p>
<h3 id="什么是Custom-Tabs"><a href="#什么是Custom-Tabs" class="headerlink" title="什么是Custom Tabs?"></a>什么是Custom Tabs?</h3><p>所有的APP开发者都面临这样一个选择，当用户点击一个URL时，是应该用浏览器打开还是应该用应用内置的WebView打开呢？</p>
<p>两个选项都面临着一些问题。通过浏览器打开是一个非常重的上下文切换，并且是无法定制的。而WebView不能和浏览器共享数据并且需要需要手动去处理更多的场景。</p>
<p>Chrome Custom Tabs让APP在进行网页浏览时更多的控制权限，在不采用WebView的情况下，这既能保证Native APP和网页之间流畅的切换，又允许APP定制Chrome的外观和操作。可定义的内容如下：</p>
<ul>
<li>toolbar的颜色</li>
<li>进场和退场动画</li>
<li>给Chrome的toolbar、overflow menu和bottom toolbar添加自定义操作</li>
</ul>
<p>并且，Chrome Custom Tabs允许开发者对Chrome进行预启动和网页内容的预加载，以此提升加载的速度。<br><img src="/2017/01/05/提升体验-Chrome-Custom-Tabs/performance.gif" alt="preformance" title="preformance"></p>
<h3 id="Chrome-Custom-Tabs-VS-WebView-我应该什么时候用？"><a href="#Chrome-Custom-Tabs-VS-WebView-我应该什么时候用？" class="headerlink" title="Chrome Custom Tabs VS WebView, 我应该什么时候用？"></a>Chrome Custom Tabs VS WebView, 我应该什么时候用？</h3><p>如果页面的内容是由我们自己控制的，可以和Android组件进行交互，那么,WebView是一个好的选择，如果我们的应用需要打开外部的网站，那么推荐使用Chrome Custom Tabs，原因如下：</p>
<ul>
<li>导入非常简单。不需要编写额外的代码来管理请求，授予权限或者存储cookie</li>
<li>定制UI：<ul>
<li>Toolbar 颜色</li>
<li>动作按钮 (Action Button)</li>
<li>定制菜单项</li>
<li>定制进场退场动画</li>
<li>Bottom Toolbar</li>
</ul>
</li>
<li>导航感知：浏览器通知回调接口通知应用网页的导航情况</li>
<li>安全性：浏览器使用了Google’s Safe Browsing，用于保护用户和设备免受危险网站的侵害</li>
<li>性能优化：<ul>
<li>浏览器会在后台进行预热，避免了应用占用大量资源的情况</li>
<li>提前向浏览器发送可能的URL，提高了页面加载速度</li>
</ul>
</li>
<li>生命周期管理：在用户与Custom Tabs进行交互时，浏览器会将应用标示为前台应用，避免了应用被系统所回收</li>
<li>共享cookie数据和权限，这样，用户在已经授权过的网站，就不需要重新登录或者授权权限了</li>
<li>如果用户开启了数据节省功能，在这里仍然可以从中受益</li>
<li>同步的自动补全功能</li>
<li>仅仅需要点击一下左上角按钮就可以直接返回原应用</li>
<li>想要在Lollipop之前的设备上最新引入的浏览器(Auto updating WebView),而不是旧版本的WebView</li>
</ul>
<h3 id="什么时候可用？"><a href="#什么时候可用？" class="headerlink" title="什么时候可用？"></a>什么时候可用？</h3><p>从Chrome 45版本开始，所有的Chrome用户都可以使用这项功能，目前仅支持Android系统。</p>
<h3 id="开发指南"><a href="#开发指南" class="headerlink" title="开发指南"></a>开发指南</h3><p>完整的示例可以查看<a href="https://github.com/GoogleChrome/custom-tabs-client" target="_blank" rel="external">https://github.com/GoogleChrome/custom-tabs-client</a>。包含了定制UI、连接后台服务、处理应用和Custom Tab Activity生命周期的可复用的类。</p>
<p>第一步当然是将<a href="http://developer.android.com/tools/support-library/features.html#custom-tabs" target="_blank" rel="external"> Custom Tabs Support Library </a>添加到工程中来。打开<code>build.gradle</code>文件，添加support library的依赖。</p>
<pre><code>dependencies {
    ...
    compile &#39;com.android.support:customtabs:23.3.0&#39;
}
</code></pre><p>一旦Support Library添加项目成功了，我们就有两种可能的定制操作了：</p>
<ul>
<li>定制UI和与Chrome Custom Tabs的交互</li>
<li>使页面加载更快速，保持应用激活</li>
</ul>
<p>UI的定制是通过使用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsIntent.html" target="_blank" rel="external"> CustomTabsIntent </a>和<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsIntent.Builder.html" target="_blank" rel="external"> CustomTabsIntent.Builder</a>类完成的；而速度的提升则是通过使用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html" target="_blank" rel="external"> CustomTabsClient </a>链接Custom Tabs服务，预热Chrome和让Chrome知晓将要打开的URL实现的。</p>
<h4 id="打开一个Chrome-Custom-Tab"><a href="#打开一个Chrome-Custom-Tab" class="headerlink" title="打开一个Chrome Custom Tab"></a>打开一个Chrome Custom Tab</h4><pre><code class="java">// 使用CustomTabsIntent.Builder配置CustomTabsIntent
// 准备完成后，调用CustomTabsIntent.Builder.build()方法创建一个CustomTabsIntent
// 并通过CustomTabsIntent.launchUrl()方法加载希望加载的url

String url = ¨https://github.com/TonnyL¨;
CustomTabsIntent.Builder builder = new CustomTabsIntent.Builder();
CustomTabsIntent customTabsIntent = builder.build();
customTabsIntent.launchUrl(this, Uri.parse(url));
</code></pre>
<h4 id="配置地址栏的颜色"><a href="#配置地址栏的颜色" class="headerlink" title="配置地址栏的颜色"></a>配置地址栏的颜色</h4><p>Chrome Custom Tabs一个很重要的功能就是我们能够改变地址栏的颜色，使之和我们应用的颜色协调。</p>
<pre><code class="java">// 改变toolbar的背景色。colorInt就是想要指定的int值

builder.setToolbarColor(colorInt);
</code></pre>
<h4 id="配置定制化的action-button"><a href="#配置定制化的action-button" class="headerlink" title="配置定制化的action button"></a>配置定制化的action button</h4><p>作为应用的开发者，我们对呈现在用户眼前的Chrome Custom Tab内的Action Button拥有完全的控制权。</p>
<p>在大部分的情况下，用户会执行最基础的操作像分享，或者是其他公共的Activity。</p>
<p>Action Button被表示为一个action button的图标和用户点击action button之后Chrome将要执行的pendingIntent。图标的高度一般为24dp，宽度一般为24-48dp。</p>
<img src="/2017/01/05/提升体验-Chrome-Custom-Tabs/tumblr_action.png" alt="actions" title="actions">
<pre><code class="java">// 向toolbar添加一个Action Button
// ‘icon’是一张位图(Bitmap)，作为action button的图片资源使用

// &#39;description&#39;是一个字符串，作为按钮的无障碍描述所使用

// &#39;pendingIntent&#39; 是一个PendingIntent，当action button或者菜单项被点击时调用。
// 在url作为data被添加之后，Chrome 会调用PendingIntent#send()方法。
// 客户端应用会通过调用Intent#getDataString()获取到URL

// &#39;tint&#39;是一个布尔值，定义了Action Button是否应该被着色

builder.setActionButton(icon, description, pendingIntent, tint);
</code></pre>
<h4 id="配置定制化菜单"><a href="#配置定制化菜单" class="headerlink" title="配置定制化菜单"></a>配置定制化菜单</h4><p>Chrome浏览器拥有非常全面的action菜单，用户在浏览器内操作非常顺畅。然而，对于我们自己的应用，可能就不适合了。</p>
<p>Chrome Custom Tabs顶部有三个横向排列的图标，分别是“前进”、”页面信息”和”刷新“。在菜单的底部分别是”查找页面”和“在浏览器中打开”。</p>
<p>作为开发者，我们最多可以在顶部横向图标和底部菜单之间添加5个自定义菜单选项。</p>
<p>菜单项通过调用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsIntent.Builder.html#addMenuItem(java.lang.String, android.app.PendingIntent" target="_blank" rel="external">CustomTabsIntent.Builder#addMenuItem</a>)添加，title和用户点击菜单选项后Chrome调用的pendingIntent需要作为参数被传入。</p>
<img src="/2017/01/05/提升体验-Chrome-Custom-Tabs/twitter_menu.png" alt="menu" title="menu">
<pre><code class="java">builder.addMenuItem(menuItemTitle, menuItemPendingIntent);
</code></pre>
<h4 id="配置进场和退场动画"><a href="#配置进场和退场动画" class="headerlink" title="配置进场和退场动画"></a>配置进场和退场动画</h4><p>许多的Android都会在Activity之间切换时使用自定义的视图进入和退出动画。Chrome Custom Tabs也一样，我们可以改变进入和退出动画，以此保持Chrome Custom Tabs和应用其他内容的协调性和一致性。</p>
<pre><code class="java">builder.setStartAnimations(this, R.anim.slide_in_right, R.anim.slide_out_left);
builder.setExitAnimations(this, R.anim.slide_in_left, R.anim.slide_out_right);
</code></pre>
<h4 id="预热Chrome，提高页面加载速度"><a href="#预热Chrome，提高页面加载速度" class="headerlink" title="预热Chrome，提高页面加载速度"></a>预热Chrome，提高页面加载速度</h4><p>默认情况下，当<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsIntent.html#launchUrl(android.app.Activity, android.net.Uri" target="_blank" rel="external"> CustomTabsIntent#launchUrl </a>)被调用时会激活Chrome，加载URL。这会花费我们宝贵的时间并且影响流畅度。</p>
<p>Chrome团队了解用户对于流畅体验的渴望，所以他们在Chrome中提供了一个Service使我们的APP能够连接并且预热浏览器和原生组件。他们也把这种能力分享给了我们普通开发者，开发者能够告知Chrome用户访问页面的可能性。然后，Chrome就能完成如下的操作：</p>
<ul>
<li>主域名的DNS预解析</li>
<li>最有可能加载的资源的DNS预解析</li>
<li>包括HTTPS/TLS验证在内的预连接</li>
</ul>
<p>预热Chrome的步骤如下：</p>
<ul>
<li>使用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html#bindCustomTabsService(android.content.Context, java.lang.String, android.support.customtabs.CustomTabsServiceConnection" target="_blank" rel="external">CustomTabsClient#bindCustomTabsService</a>)连接service</li>
<li>一旦service连接成功，后台调用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html#warmup(long" target="_blank" rel="external"> CustomTabsClient#warmup</a>)启动Chrome</li>
<li>调用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html#newSession(android.support.customtabs.CustomTabsCallback" target="_blank" rel="external"> CustomTabsClient#newSession </a>)创建一个新的session.这个session被用作所有的API请求</li>
<li>我们可以在创建session时选择性的添加一个<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsCallback.html" target="_blank" rel="external"> CustomTabsCallback</a>作为参数，这样我们就能知道页面是否被加载完成</li>
<li>通过<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsSession.html#mayLaunchUrl(android.net.Uri, android.os.Bundle, java.util.List&lt;android.os.Bundle" target="_blank" rel="external"> CustomTabsSession#mayLaunchUrl</a>)告知Chrome用户最有可能加载的页面</li>
<li>调用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsIntent.Builder.html" target="_blank" rel="external"> CustomTabsIntent.Builder </a>构造方法，并传入已经创建好的<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsSession.html" target="_blank" rel="external">CustomTabsSession</a>作为参数传入</li>
</ul>
<h4 id="连接Chrome服务"><a href="#连接Chrome服务" class="headerlink" title="连接Chrome服务"></a>连接Chrome服务</h4><p><a href="("> CustomTabsClient#bindCustomTabsService </a><a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html#bindCustomTabsService(android.content.Context" target="_blank" rel="external">http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html#bindCustomTabsService(android.content.Context</a>, java.lang.String, android.support.customtabs.CustomTabsServiceConnectio)) 方法简化了连接Custom Tabs服务的过程。</p>
<p>创建一个继承自<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsServiceConnection.html" target="_blank" rel="external">CustomTabsServiceConnection</a>的类并使用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsServiceConnection.html#onCustomTabsServiceConnected(android.content.ComponentName, android.support.customtabs.CustomTabsClient" target="_blank" rel="external">onCustomTabsServiceConnected </a>)方法获取<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html" target="_blank" rel="external"> CustomTabsClient</a>的实例。在下一步中会用到此实例：</p>
<pre><code class="java">// 官方示例
// 客户端需要连接的Chrome的包名，取决于channel的名称
// Stable(发行版) = com.android.chrome
// Beta(测试版) = com.chrome.beta
// Dev(开发版) = com.chrome.dev
public static final String CUSTOM_TAB_PACKAGE_NAME = &quot;com.android.chrome&quot;;  // Change when in stable

CustomTabsServiceConnection connection = new CustomTabsServiceConnection() {
    @Override
    public void onCustomTabsServiceConnected(ComponentName name, CustomTabsClient client) {
        mCustomTabsClient = client;
    }

    @Override
    public void onServiceDisconnected(ComponentName name) {

    }
};
boolean ok = CustomTabsClient.bindCustomTabsService(this, mPackageNameToBind, connection);
</code></pre>
<pre><code class="java">// 我的示例
package com.marktony.zhihudaily.customtabs;

import android.support.customtabs.CustomTabsServiceConnection;
import android.content.ComponentName;
import android.support.customtabs.CustomTabsClient;

import java.lang.ref.WeakReference;

/**
 * Created by Lizhaotailang on 2016/9/4.
 * Implementation for the CustomTabsServiceConnection that avoids leaking the
 * ServiceConnectionCallback
 */

public class ServiceConnection extends CustomTabsServiceConnection {

    // A weak reference to the ServiceConnectionCallback to avoid leaking it.
    private WeakReference&lt;ServiceConnectionCallback&gt; mConnectionCallback;

    public ServiceConnection(ServiceConnectionCallback connectionCallback) {
        mConnectionCallback = new WeakReference&lt;&gt;(connectionCallback);
    }

    @Override
    public void onCustomTabsServiceConnected(ComponentName name, CustomTabsClient client) {
        ServiceConnectionCallback connectionCallback = mConnectionCallback.get();
        if (connectionCallback != null) connectionCallback.onServiceConnected(client);
    }

    @Override
    public void onServiceDisconnected(ComponentName name) {
        ServiceConnectionCallback connectionCallback = mConnectionCallback.get();
        if (connectionCallback != null) connectionCallback.onServiceDisconnected();
    }

}
</code></pre>
<h4 id="预热浏览器"><a href="#预热浏览器" class="headerlink" title="预热浏览器"></a>预热浏览器</h4><p><a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html#warmup(long" target="_blank" rel="external">boolean warmup(long flags)</a>)</p>
<p>预热浏览器进程并加重原生库文件。预热是异步进行的，返回值表示请求是否被接收。多个成功的请求都会返回true。</p>
<p><code>true</code>代表着成功。</p>
<h4 id="创建新的tab-sessioin"><a href="#创建新的tab-sessioin" class="headerlink" title="创建新的tab sessioin"></a>创建新的tab sessioin</h4><p><a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html#newSession(android.support.customtabs.CustomTabsCallback" target="_blank" rel="external">boolean newSession(CustomTabsCallback callback)</a>)</p>
<p>session用于在连续请求中链接mayLaunchUrl方法。CustomTabsIntent和tab互相联系。这里所提供的回调和已经创建成功的session相关。通过这个回调，任何关于已经成功创建的session的更新都会被接收到。返回session是否被成功创建。多个具有相同CustomTabsCallback或者null值的请求都会返回false。</p>
<h4 id="告知Chrome用户可能打开的链接"><a href="#告知Chrome用户可能打开的链接" class="headerlink" title="告知Chrome用户可能打开的链接"></a>告知Chrome用户可能打开的链接</h4><p><a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsSession.html#mayLaunchUrl(android.net.Uri, android.os.Bundle, java.util.List&lt;android.os.Bundle" target="_blank" rel="external">boolean mayLaunchUrl(Uri url, Bundle extras, List otherLikelyBundles)</a>)</p>
<p>CustomTabsSession方法告知浏览器未来可能导航到的url。<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html#warmup(long" target="_blank" rel="external">warmup()</a>)方法应该先被调用。最有可能的url应该最先被指出。也可以选择性的提供可能加载的url的列表。列表中的数据被认为被加载的可能性小于最初的那一个，而且必须按照优先级降序排列。这些额外的url可能被忽略掉。所有之前对于这个方法的调用都会被去优先化。返回操作是否成功完成。</p>
<h4 id="Custom-Tabs连接回调"><a href="#Custom-Tabs连接回调" class="headerlink" title="Custom Tabs连接回调"></a>Custom Tabs连接回调</h4><p><a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsCallback.html#onNavigationEvent(int, android.os.Bundle" target="_blank" rel="external">void onNavigationEvent(int navigationEvent, Bundle extras)</a>)</p>
<p>在custom tab中，导航事件发生时被调用。‘navigationEvent int’是关于页面内的6个状态值之一。6个状态值定义如下：</p>
<pre><code class="java">/**
* 页面开始加载时被发送
*/
public static final int NAVIGATION_STARTED = 1;

/**
* 页面完成加载时被发送
*/
public static final int NAVIGATION_FINISHED = 2;

/**
* 由于错误tab不能完成加载时被发送
*/
public static final int NAVIGATION_FAILED = 3;

/**
* 在加载完成之前，加载因为用户动作例如点击了另外一个链接或者刷新页面
* 加载被中止时被发送
*/
public static final int NAVIGATION_ABORTED = 4;

/**
* tab状态变为可见时发送
*/
public static final int TAB_SHOWN = 5;

/**
* tab状态变为不可见时发送
*/
public static final int TAB_HIDDEN = 6;
</code></pre>
<h4 id="如果用户没有安装最新版本的Chrome，会发生什么呢？"><a href="#如果用户没有安装最新版本的Chrome，会发生什么呢？" class="headerlink" title="如果用户没有安装最新版本的Chrome，会发生什么呢？"></a>如果用户没有安装最新版本的Chrome，会发生什么呢？</h4><p>Custom Tabs通过带有key Extras的 ACTION_VIEW Intent来定制UI。这就意味着将要打开的页面会通过系统浏览器或者用户默认浏览器打开。</p>
<p>如果用户已经安装了Chrome并且是默认浏览器，它会自动的获取EXTRAS的值并提供一个定制化的UI。其他的浏览器使用Intent extras提供相同的定制UI也是有可能的。</p>
<h4 id="怎样检测Chrome是否支持Chrome-Custom-Tabs"><a href="#怎样检测Chrome是否支持Chrome-Custom-Tabs" class="headerlink" title="怎样检测Chrome是否支持Chrome Custom Tabs?"></a>怎样检测Chrome是否支持Chrome Custom Tabs?</h4><p>所有支持Chrome Custom Tabs的Chrome浏览器都暴露了一个service。为了检测是否支持Chrome Custom Tabs，可以尝试着绑定service，如果成功的话，那么Customs Tabs可以成功的使用。</p>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><p>启用Chrome Custom Tabs后,我们看到了各种不同质量界别的实现效果。这里介绍一组实现优秀集成的最佳实践。</p>
<h4 id="连接Custome-Tabs-Service并发起预热"><a href="#连接Custome-Tabs-Service并发起预热" class="headerlink" title="连接Custome Tabs Service并发起预热"></a>连接Custome Tabs Service并发起预热</h4><p>连接到Custom Tabs Service并预加载Chrome之后，通过Custom Tabs打开链接 <strong>最多可以节省700ms</strong> 。</p>
<p>在我们打算启用Custom Tabs的Activity的 <a href="http://developer.android.com/reference/android/app/Activity.html#onStart(" target="_blank" rel="external">onStart()</a>) 方法中连接 Custom Tabs service。连接成功后，调用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsClient.html#warmup%28long%29" target="_blank" rel="external">warmup()</a>方法。</p>
<p>Custom Tabs作为一个非常低优先级的进程，这也就意味着 <strong>它不会对我们的应用不会有任何的负面的影响</strong>，但是当加载链接时，会获得非常好的启动性能。</p>
<h4 id="内容预渲染"><a href="#内容预渲染" class="headerlink" title="内容预渲染"></a>内容预渲染</h4><p>预渲染让内容打开非常迅速。所以，如果用户 <strong>至少有50%的可能性</strong> 打开某个链接，调用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsSession.html#mayLaunchUrl%28android.net.Uri,%20android.os.Bundle,%20java.util.List%3Candroid.os.Bundle%3E%29" target="_blank" rel="external">mayLaunchUrl()</a><br>方法。</p>
<p>调用<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsSession.html#mayLaunchUrl%28android.net.Uri,%20android.os.Bundle,%20java.util.List%3Candroid.os.Bundle%3E%29" target="_blank" rel="external">mayLaunchUrl()</a><br>方法方法能使Custom Tabs预获取主页面所支持的内容并预渲染。这会最大程度的加快页面的加载速度。但是会不可避免的有 <strong>一点流量和电量的消耗</strong>。</p>
<p>Custom Tabs非常的智能，能够感知用户是否在使用收费的网络或者设备电量不足，预渲染对设备的整体性能有负面的影响，在这样的场景下，Custom Tabs就不会进行预获取或者预渲染。所以，不用担心应用的性能问题。</p>
<h4 id="当Custom-Tabs没有安装时，提供备选方案"><a href="#当Custom-Tabs没有安装时，提供备选方案" class="headerlink" title="当Custom Tabs没有安装时，提供备选方案"></a>当Custom Tabs没有安装时，提供备选方案</h4><p>尽管Custom Tabs对于大多数用户都是适用的，仍然有一些场景不适用，例如设备上没有安装支持Custom Tabs的浏览器或者是设备上的浏览器版本不支持Custom Tabs。</p>
<p><strong>确保提供了备选方案以提供好的应用体验</strong>。打开默认浏览器或者引入WebView都是不错的选择。</p>
<h4 id="将我们的应用作为referrer-引荐来源"><a href="#将我们的应用作为referrer-引荐来源" class="headerlink" title="将我们的应用作为referrer(引荐来源)"></a>将我们的应用作为referrer(引荐来源)</h4><p>通常，对于网站而言，追用访问的来源非常地重要。当加载了Custom Tabs时，通过设置referrer，让他们知晓我们正在给他们提高访问量。</p>
<pre><code class="java">intent.putExtra(Intent.EXTRA_REFERRER,
        Uri.parse(Intent.URI_ANDROID_APP_SCHEME + &quot;//&quot; + context.getPackageName()));
</code></pre>
<h4 id="添加定制动画"><a href="#添加定制动画" class="headerlink" title="添加定制动画"></a>添加定制动画</h4><p>定制的动画能够使我们的应用切换到网页内容时更加地顺畅。 确保进场动画和出厂动画是反向的，这样能够帮助用户理解跳转的关系。</p>
<pre><code class="java">   //设置定制的进入/退出动画
    CustomTabsIntent.Builder intentBuilder = new CustomTabsIntent.Builder();
    intentBuilder.setStartAnimations(this, R.anim.slide_in_right, R.anim.slide_out_left);
    intentBuilder.setExitAnimations(this, android.R.anim.slide_in_left,
        android.R.anim.slide_out_right);

    //打开Custom Tab        
    intentBuilder.build().launchUrl(context, Uri.parse(&quot;https://github.com/TonnyL&quot;));
</code></pre>
<h4 id="为Action-Button选择一个icon"><a href="#为Action-Button选择一个icon" class="headerlink" title="为Action Button选择一个icon"></a>为Action Button选择一个icon</h4><p>添加一个Action Button能够使用户更加理解APP的功能。但是，如果没有好的icon代表Action Button将要执行的操作，有必要创建一个带操作文字描述的位图。</p>
<p>牢记位图的最大尺寸为高度24dp，宽度48dp。</p>
<pre><code class="java">    String shareLabel = getString(R.string.label_action_share);
    Bitmap icon = BitmapFactory.decodeResource(getResources(),
            android.R.drawable.ic_menu_share);

    // 为我们的BroadCastReceiver创建一个PendingIntent
    Intent actionIntent = new Intent(
            this.getApplicationContext(), ShareBroadcastReceiver.class);
    PendingIntent pendingIntent =
            PendingIntent.getBroadcast(getApplicationContext(), 0, actionIntent, 0);            

     // 设置pendingIntent作为按钮被点击后将要执行的操作    
    intentBuilder.setActionButton(icon, shareLabel, pendingIntent);
</code></pre>
<h4 id="为其他浏览器做准备"><a href="#为其他浏览器做准备" class="headerlink" title="为其他浏览器做准备"></a>为其他浏览器做准备</h4><p>牢记用户安装的浏览器中，支持Custom Tabs的数量可能不止一个。如果有不止一个浏览器支持Custom Tabs，并且没有任何一个浏览器被设置为偏好浏览器，需要询问用户如何打开链接</p>
<pre><code class="java">    /**
     * 返回支持Custom Tabs的应用的包名
     */
    public static ArrayList getCustomTabsPackages(Context context) {
        PackageManager pm = context.getPackageManager();
        // Get default VIEW intent handler.
        Intent activityIntent = new Intent(Intent.ACTION_VIEW, Uri.parse(&quot;http://www.example.com&quot;));

        // 获取所有能够处理VIEW intents的应用
        List resolvedActivityList = pm.queryIntentActivities(activityIntent, 0);
        ArrayList packagesSupportingCustomTabs = new ArrayList&lt;&gt;();
        for (ResolveInfo info : resolvedActivityList) {
            Intent serviceIntent = new Intent();
            serviceIntent.setAction(ACTION_CUSTOM_TABS_CONNECTION);
            serviceIntent.setPackage(info.activityInfo.packageName);
            // Check if this package also resolves the Custom Tabs service.
            if (pm.resolveService(serviceIntent, 0) != null) {
                packagesSupportingCustomTabs.add(info);
            }
        }
        return packagesSupportingCustomTabs;
    }
</code></pre>
<h4 id="允许用户不使用Custom-Tabs"><a href="#允许用户不使用Custom-Tabs" class="headerlink" title="允许用户不使用Custom Tabs"></a>允许用户不使用Custom Tabs</h4><p>为应用添加一个设置选项，允许用户通过默认浏览器而不是Custom Tab打开链接。如果我们的应用在添加Custom Tabs之前，都是通过默认浏览器打开链接显得尤为重要。</p>
<h4 id="尽量让Native应用处理URL"><a href="#尽量让Native应用处理URL" class="headerlink" title="尽量让Native应用处理URL"></a>尽量让Native应用处理URL</h4><p>Native应用可以处理一些url。如果用户安装了Twitter APP，在点击tweet内的链接时，她更加希望Twitter应用能够处理这些链接。</p>
<p>在应用内打开链接之前，检查手机里有没有其他APP能够处理这些url。</p>
<h4 id="定制Toolbar的颜色"><a href="#定制Toolbar的颜色" class="headerlink" title="定制Toolbar的颜色"></a>定制Toolbar的颜色</h4><p>如果想要让用户感觉网页内容是我们应用的一部分，将toolbar的颜色设置为primaryColor。</p>
<p>如果想要让用户清楚的了解到已经离开了我们的应用，那就完全不要定义toolbar的颜色。</p>
<pre><code class="java">    // 设置自定义的toolbar的颜色
    CustomTabsIntent.Builder intentBuilder = new CustomTabsIntent.Builder();
    intentBuilder.setToolbarColor(Color.BLUE);
</code></pre>
<h4 id="增加分享按钮"><a href="#增加分享按钮" class="headerlink" title="增加分享按钮"></a>增加分享按钮</h4><p>确保在overflow菜单中添加了一个分享的操作，在大多数的情况下，用户希望能够分享当前所见网页内容的链接，Custom Tabs默认没有添加分享的按钮。</p>
<pre><code class="java">    // 在BroadCastReceiver中分享来自CustomTabs的内容
    public void onReceive(Context context, Intent intent) {
        String url = intent.getDataString();

        if (url != null) {
            Intent shareIntent = new Intent(Intent.ACTION_SEND);
            shareIntent.setType(&quot;text/plain&quot;);
            shareIntent.putExtra(Intent.EXTRA_TEXT, url);

            Intent chooserIntent = Intent.createChooser(shareIntent, &quot;Share url&quot;);
            chooserIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);

            context.startActivity(chooserIntent);
        }
    }
</code></pre>
<h4 id="定制关闭按钮"><a href="#定制关闭按钮" class="headerlink" title="定制关闭按钮"></a>定制关闭按钮</h4><p>自定义关闭按钮使CustomTabs看起来像应用的一部分。</p>
<p>如果希望CustomTabs在用户看来像一个Dialog, 使用’x’(叉叉)按钮。如果希望Custom Tab是用户的一部分，使用返回箭头。</p>
<pre><code class="java">    //设置自定义的关闭按钮
    CustomTabsIntent.Builder intentBuilder = new CustomTabsIntent.Builder();
    intentBuilder.setCloseButtonIcon(BitmapFactory.decodeResource(
        getResources(), R.drawable.ic_arrow_back));
</code></pre>
<h4 id="处理内部链接"><a href="#处理内部链接" class="headerlink" title="处理内部链接"></a>处理内部链接</h4><p>当监听到链接是由<a href="http://developer.android.com/reference/android/widget/TextView.html#attr_android:autoLink" target="_blank" rel="external">android:autoLink</a>生成的或者在WebView中复写了click方法，确保我们的应用处理了这些内容的链接，让CustomTabs处理外部链接。</p>
<pre><code class="java">WebView webView = (WebView)findViewById(R.id.webview);
webView.setWebViewClient(new WebViewClient() {
    @Override
    public boolean shouldOverrideUrlLoading(WebView view, String url) {
        return true;
    }

    @Override
    public void onLoadResource(WebView view, String url) {
        if (url.startsWith(&quot;http://www.example.com&quot;)) {
            //Handle Internal Link...
        } else {
            //Open Link in a Custom Tab
            Uri uri = Uri.parse(url);
            CustomTabsIntent.Builder intentBuilder =
                    new CustomTabsIntent.Builder(mCustomTabActivityHelper.getSession());
           //Open the Custom Tab        
            intentBuilder.build().launchUrl(context, url));                            
        }
    }
});
</code></pre>
<h4 id="处理连击"><a href="#处理连击" class="headerlink" title="处理连击"></a>处理连击</h4><p>如果希望在用户点击链接和打开CustomTabs之间做一些准备工作，确保所花费的时间不超过100ms。否则用户会认为APP没有响应，可能是试着点击链接多次。</p>
<p>如果不能避免延迟，确保我们的应用对可能的情况做好准备，当用户点击相同的链接多次时，不要多次打开CustomTab。</p>
<h3 id="低版本API"><a href="#低版本API" class="headerlink" title="低版本API"></a>低版本API</h3><p>尽管整合Custom Tabs的推荐方式是使用Custom Tabs Support Library，低API版本的系统也是可以使用的。</p>
<p>完整的Support Library的导入方法可以参见<a href="https://github.com/GoogleChrome/custom-tabs-client/tree/master/customtabs" target="_blank" rel="external">GitHub</a>,并可以做为一个起点。连接service的<a href="http://developer.android.com/guide/components/aidl.html" target="_blank" rel="external">AIDL文件</a>也被包含在其中，Chromium仓库中也包含了这些文件，而这些文件在Android Studio中是不能直接被使用的。</p>
<h4 id="在低版本API中使用Custom-Tabs的基本方法"><a href="#在低版本API中使用Custom-Tabs的基本方法" class="headerlink" title="在低版本API中使用Custom Tabs的基本方法"></a>在低版本API中使用Custom Tabs的基本方法</h4><pre><code class="java">
String url = ¨https://github.com/TonnyL¨;
Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));

private static final String EXTRA_CUSTOM_TABS_SESSION = &quot;android.support.customtabs.extra.SESSION&quot;;
Bundle extras = new Bundle;
extras.putBinder(EXTRA_CUSTOM_TABS_SESSION,
   sessionICustomTabsCallback.asBinder() /* 不需要session时设置为null */);
intent.putExtras(extras);
</code></pre>
<h4 id="定制UI"><a href="#定制UI" class="headerlink" title="定制UI"></a>定制UI</h4><p>UI定制是通过向ACTION_VIEW Intent添加Extras实现的。用于定制UI的完整的extras keys的列表可以在<a href="http://developer.android.com/reference/android/support/customtabs/CustomTabsIntent.html" target="_blank" rel="external"> CustomTabsIntent docs </a>找到。下面是添加自定义的toolbar的颜色的示例：</p>
<pre><code class="java">private static final String EXTRA_CUSTOM_TABS_TOOLBAR_COLOR = &quot;android.support.customtabs.extra.TOOLBAR_COLOR&quot;;
intent.putExtra(EXTRA_CUSTOM_TABS_TOOLBAR_COLOR, colorInt);
</code></pre>
<h4 id="连接Custom-Tabs-Service"><a href="#连接Custom-Tabs-Service" class="headerlink" title="连接Custom Tabs Service"></a>连接Custom Tabs Service</h4><p>Custom Tabs service和其他Android Service的使用方法相同。接口通过AIDL创建并且代理service类也会自动创建。</p>
<pre><code>// 客户端需要连接的Chrome的包名，取决于channel的名称
// Stable(发行版) = com.android.chrome
// Beta(测试版) = com.chrome.beta
// Dev(开发版) = com.chrome.dev
public static final String CUSTOM_TAB_PACKAGE_NAME = &quot;com.chrome.dev&quot;;  // Change when in stable

public static final String ACTION_CUSTOM_TABS_CONNECTION =
       &quot;android.support.customtabs.action.CustomTabsService&quot;;
Intent serviceIntent = new Intent(ACTION_CUSTOM_TABS_CONNECTION);

serviceIntent.setPackage(CUSTOM_TAB_PACKAGE_NAME);
context.bindService(serviceIntent, mServiceConnection,
                    Context.BIND_AUTO_CREATE | Context.BIND_WAIVE_PRIORITY);
</code></pre><h3 id="一些有用的网址"><a href="#一些有用的网址" class="headerlink" title="一些有用的网址"></a>一些有用的网址</h3><ul>
<li><a href="https://github.com/GoogleChrome/custom-tabs-client" target="_blank" rel="external">Github Demo</a></li>
<li><a href="http://stackoverflow.com/questions/tagged/chrome-custom-tabs" target="_blank" rel="external">Chrome Custom Tabs on StackOverflow</a></li>
<li>我的项目地址:<a href="https://github.com/TonnyL/PaperPlane" target="_blank" rel="external">PaperPlane</a></li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>如果我们的应用是面向国外用户的，那理所当然的，应该加入Chrome Custom Tabs的支持，这在很大程度上能够提升用户的体验。如果我们的应用只是面向国内用户，我的建议还是应该加上这项功能，毕竟，还是有部分用户安装了Chrome浏览器，当用户浏览到Custom Tab页面，应该也会像我一样，感觉到眼前一亮吧。</p>
<p>文章比较长，感谢阅读。</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用多说评论 -->
    <link rel="stylesheet" href="/css/duoshuo.min.css">
<style>
    #ds-thread #ds-reset .ds-post-button{
        background-color: #0097A7 !important;
    }
    #ds-wrapper #ds-reset .ds-icons-32{
        background-color: #0097A7 !important;
    }
    #ds-reset .ds-highlight {
        color: #0097A7 !important;
    }
</style>
<div id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread"
        data-thread-key="2017/01/05/提升体验-Chrome-Custom-Tabs/"
        data-url="http://tonnyl.github.io/2017/01/05/提升体验-Chrome-Custom-Tabs/"
        data-title="提升体验-Chrome Custom Tabs">
    </div>
    <!-- 多说评论框 end -->
</div>









                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/01/06/Lambda在Android中的使用/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/12/31/简洁优雅地实现夜间模式/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Tonny's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        marktonymengyi@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:marktonymengyi@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/04/">April 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">December 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">September 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">July 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">June 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">May 2016<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Android/">Android<span class="sidebar_archives-count">17</span></a></li><li><a class="sidebar_archives-link" href="/categories/GitHub/">GitHub<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Java/">Java<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/涨姿势/">涨姿势<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/计算机基础/">计算机基础<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/设计模式/">设计模式<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/闲谈/">闲谈<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
            <li class="divider"></li>
        
    
        <li>
            <a href="/links" title="Links">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                Links
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">28</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            Theme - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

    <a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.help
        <span class="mdl-button__ripple-container">
          <span class="mdl-ripple"></span>
        </span>
      </div>
    </a>

-->

<!-- Feedback -->
<!--

    <a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.feedback
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

<!-- About Theme -->
<!--

    <a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
             sidebar.about_theme
            <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/TonnyLZTL" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    

    <!-- Google + -->
    
        <a href="https://plus.google.com/101922840132193208151" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.svg);">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/5313690193/profile?topnav=1&amp;wvr=6" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.svg);">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    
        <a href="https://www.instagram.com/tonny_lztl/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-instagram.svg);">
                <span class="visuallyhidden">Instagram</span>
            </button><!--
     --></a>
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/TonnyL" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.svg);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://www.zhihu.com/people/kirin-momo/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-zhihu.svg);">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
        <a href="https://t.me/TonnyLZ" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-telegram.svg);">
                <span class="visuallyhidden">Telegram</span>
            </button><!--
     --></a>
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;Tonny's Blog
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="https://materialcdn.nfz.moe/hexo/1.3.2/js/lazyload.min.js"></script>
    <script src="https://materialcdn.nfz.moe/hexo/1.3.2/js/js.min.js"></script>



    <script src="https://materialcdn.nfz.moe/hexo/1.3.2/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    <!-- 多说公共 js 代码 start -->
    <script type="text/javascript">
        queue.offer(function(){
            var duoshuoQuery = {
                short_name: 'tonnysblog'
            };
            (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';
                ds.async = true;
                ds.src = 'https://static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0]
                 || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
        });
    </script>
    <!-- 多说公共 js 代码 end -->






<!-- Swiftye -->


<!-- Local Search-->

    <script>
    var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: 'xml',
            success: function( xmlResponse ) {
                // get the contents from search data
                var datas = $( 'entry', xmlResponse ).map(function() {
                    return {
                        title: $( 'title', this ).text(),
                        content: $('content',this).text(),
                        url: $( 'url' , this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function() {
                    var str='<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = '';
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function(data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g,'').toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if(data_title !== '' && data_content !== '') {
                            keywords.forEach(function(keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if( index_title < 0 && index_content < 0 ) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += '<li><a href="'+ data_url +'" class="search-result-title" target="_blank">'+ data_title;
                            var content = data.content.trim().replace(/<[^>]+>/g, '');
                            if (first_occur >= 0) {
                                // cut out characters
                                var start = first_occur - 6;
                                var end = first_occur + 6;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 10;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, 'gi');
                                    match_content = match_content.replace(regS, '<em class="search-keyword">'+keyword+'</em>');
                                })
                                str += '<p class="search-result">' + match_content + '...</p>' +'</a>';
                            }
                        }
                    });
                    $resultContent.innerHTML = str;
                });
            }
        });
    }
</script>


    <script>
        var inputArea = document.querySelector('#search');
        var getSearchFile = function() {
            var path = 'search.xml';
            searchFunc(path, 'search', 'local-search-result');
        }

        if(inputArea) {
            inputArea.onfocus = function() {
                getSearchFile();
            }
        }
    </script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
